-years = Protest.by_year
-year1 = (years[0]).fdiv(years[0]+years[1]+years[2]).round(2)*100
-year2 = (years[1]).fdiv(years[0]+years[1]+years[2]).round(2)*100
-year3 = (years[2]).fdiv(years[0]+years[1]+years[2]).round(2)*100
-a1  = Protest.total_rt(@dates[0] ,0)
-a2  = Protest.total_rt(@dates[1] ,0)
-a3  = Protest.total_rt(@dates[2] ,0)
-a4  = Protest.total_rt(@dates[3] ,0)
-a5  = Protest.total_rt(@dates[4] ,0)
-a6  = Protest.total_rt(@dates[5] ,0)
-a7  = Protest.total_rt(@dates[6] ,0)
-a8  = Protest.total_rt(@dates[7] ,0)
-a9  = Protest.total_rt(@dates[8] ,0)
-a10 = Protest.total_rt(@dates[9] ,0)
-a11 = Protest.total_rt(@dates[10],0)
-a12 = Protest.total_rt(@dates[11],0)
-a13 = Protest.total_rt(@dates[12],0)
-a14 = Protest.total_rt(@dates[13],0)
-a15 = Protest.total_rt(@dates[14],0)
-a16 = Protest.total_rt(@dates[15],0)
-a17 = Protest.total_rt(@dates[16],0)
-a18 = Protest.total_rt(@dates[17],0)
-a19 = Protest.total_rt(@dates[18],0)
-a20 = Protest.total_rt(@dates[19],0)
-a21 = Protest.total_rt(@dates[20],0)
-a22 = Protest.total_rt(@dates[21],0)
-a23 = Protest.total_rt(@dates[22],0)
-a24 = Protest.total_rt(@dates[23],0)
-a25 = Protest.total_rt(@dates[24],0)
-a26 = Protest.total_rt(@dates[25],0)
-b1  = Protest.total_rt(@dates[0] ,1)
-b2  = Protest.total_rt(@dates[1] ,1)
-b3  = Protest.total_rt(@dates[2] ,1)
-b4  = Protest.total_rt(@dates[3] ,1)
-b5  = Protest.total_rt(@dates[4] ,1)
-b6  = Protest.total_rt(@dates[5] ,1)
-b7  = Protest.total_rt(@dates[6] ,1)
-b8  = Protest.total_rt(@dates[7] ,1)
-b9  = Protest.total_rt(@dates[8] ,1)
-b10 = Protest.total_rt(@dates[9] ,1)
-b11 = Protest.total_rt(@dates[10],1)
-b12 = Protest.total_rt(@dates[11],1)
-b13 = Protest.total_rt(@dates[12],1)
-b14 = Protest.total_rt(@dates[13],1)
-b15 = Protest.total_rt(@dates[14],1)
-b16 = Protest.total_rt(@dates[15],1)
-b17 = Protest.total_rt(@dates[16],1)
-b18 = Protest.total_rt(@dates[17],1)
-b19 = Protest.total_rt(@dates[18],1)
-b20 = Protest.total_rt(@dates[19],1)
-b21 = Protest.total_rt(@dates[20],1)
-b22 = Protest.total_rt(@dates[21],1)
-b23 = Protest.total_rt(@dates[22],1)
-b24 = Protest.total_rt(@dates[23],1)
-b25 = Protest.total_rt(@dates[24],1)
-b26 = Protest.total_rt(@dates[25],1)
-c1  = Protest.total_rt(@dates[0] ,2)
-c2  = Protest.total_rt(@dates[1] ,2)
-c3  = Protest.total_rt(@dates[2] ,2)
-c4  = Protest.total_rt(@dates[3] ,2)
-c5  = Protest.total_rt(@dates[4] ,2)
-c6  = Protest.total_rt(@dates[5] ,2)
-c7  = Protest.total_rt(@dates[6] ,2)
-c8  = Protest.total_rt(@dates[7] ,2)
-c9  = Protest.total_rt(@dates[8] ,2)
-c10 = Protest.total_rt(@dates[9] ,2)
-c11 = Protest.total_rt(@dates[10],2)
-c12 = Protest.total_rt(@dates[11],2)
-c13 = Protest.total_rt(@dates[12],2)
-c14 = Protest.total_rt(@dates[13],2)
-c15 = Protest.total_rt(@dates[14],2)
-c16 = Protest.total_rt(@dates[15],2)
-c17 = Protest.total_rt(@dates[16],2)
-c18 = Protest.total_rt(@dates[17],2)
-c19 = Protest.total_rt(@dates[18],2)
-c20 = Protest.total_rt(@dates[19],2)
-c21 = Protest.total_rt(@dates[20],2)
-c22 = Protest.total_rt(@dates[21],2)
-c23 = Protest.total_rt(@dates[22],2)
-c24 = Protest.total_rt(@dates[23],2)
-c25 = Protest.total_rt(@dates[24],2)
-c26 = Protest.total_rt(@dates[25],2)


%h1 Protests
.row
	.col-md-12
		#protests{:style => "min-width: 620px; height: 400px; max-width: 800px; margin: 0 auto"}
%br
.row
	.col-md-12
		#piechart{:style => "min-width: 620px; height: 400px; max-width: 800px; margin: 0 auto"}

:javascript
	$(function () {
	    $('#protests').highcharts({
	        title: {
	            text: 'Retweets per Protest',
	            x: -20 //center
	        },
	        subtitle: {
	            text: 'by actors nature',
	            x: -20
	        },
	        credits:{
	          text: '',
	          href: '',
	          display:'none'
	        },
	        xAxis: {
	            categories: ['1', '2', '3', '4', '5', '6',
	                '7', '8', '9', '10', '11', '12','13','14','15','16', '17', '18','19','20','21',
	                '22', '23', '24','25','26'],
	                title:{text: 'Protests'}

	        },
	        yAxis: {
	            title: {
	                text: '% of total Retweets'
	            },
	            plotLines: [{
	                value: 0,
	                width: 1,
	                color: '#808080'
	            }],
	            min: 0
	        },
	        tooltip: {
	            valueSuffix: '% of total retweets'
	        },
	        legend: {
	            layout: 'vertical',
	            align: 'right',
	            verticalAlign: 'middle',
	            borderWidth: 0
	        },
	        series: [{
	            name: 'Leaders',
	            data: [
	               #{a1 },
	               #{a2 },
	               #{a3 },
	               #{a4 },
	               #{a5 },
	               #{a6 },
	               #{a7 },
	               #{a8 },
	               #{a9 },
	               #{a10},
	               #{a11},
	               #{a12},
	               #{a13},
	               #{a14},
	               #{a15},
	               #{a16},
	               #{a17},
	               #{a18},
	               #{a19},
	               #{a20},
	               #{a21},
	               #{a22},
	               #{a23},
	               #{a24},
	               #{a25},
	               #{a26}
	                ]
	        }, {
	            name: 'Representative Org.',
	            data: [
				   #{b1 },
	               #{b2 },
	               #{b3 },
	               #{b4 },
	               #{b5 },
	               #{b6 },
	               #{b7 },
	               #{b8 },
	               #{b9 },
	               #{b10},
	               #{b11},
	               #{b12},
	               #{b13},
	               #{b14},
	               #{b15},
	               #{b16},
	               #{b17},
	               #{b18},
	               #{b19},
	               #{b20},
	               #{b21},
	               #{b22},
	               #{b23},
	               #{b24},
	               #{b25},
	               #{b26}
	            ]
	        }, {
	            name: 'Others Org.',
	            data: [
				   #{c1 },
	               #{c2 },
	               #{c3 },
	               #{c4 },
	               #{c5 },
	               #{c6 },
	               #{c7 },
	               #{c8 },
	               #{c9 },
	               #{c10},
	               #{c11},
	               #{c12},
	               #{c13},
	               #{c14},
	               #{c15},
	               #{c16},
	               #{c17},
	               #{c18},
	               #{c19},
	               #{c20},
	               #{c21},
	               #{c22},
	               #{c23},
	               #{c24},
	               #{c25},
	               #{c26}
	            ]
	        }]
	    });
	});


	$(function () {

	    var colors = [Highcharts.Color(Highcharts.getOptions().colors[0]).brighten((0 - 3) / 7).get(),Highcharts.Color(Highcharts.getOptions().colors[0]).brighten((1 - 3) / 7).get(),Highcharts.Color(Highcharts.getOptions().colors[0]).brighten((2 - 3) / 7).get()],

	    categories = ['Year 2011', 'Year 2012', 'Year 2013'],
	    data = [{
	        y: #{year1},
	        color: colors[0],
	        drilldown: {
	            name: 'MSIE versions',
	            categories: ['Leaders', 'Representative Organizations', 'Others Organizations'],
	            data: [
	            #{(year1.fdiv(100)*(a1+a2+a3+a4+a5+a6+a7+a8+a9+a10+a11+a12+a13).fdiv(13)).round(2)},
	            #{(year1.fdiv(100)*(b1+b2+b3+b4+b5+b6+b7+b8+b9+b10+b11+b12+b13).fdiv(13)).round(2)},
	            #{(year1.fdiv(100)*(c1+c2+c3+c4+c5+c6+c7+c8+c9+c10+c11+c12+c13).fdiv(13)).round(2)}],
	            color: colors[0]
	        }
	    }, {
	         y: #{year2},
	        color: colors[1],
	        drilldown: {
	            name: 'Firefox versions',
	            categories: ['Leaders', 'Representative Organizations', 'Others Organizations'],
	            data: [
	            #{(year2.fdiv(100)*(a14+a15+a16+a17+a18).fdiv(5)).round(2)},
	            #{(year2.fdiv(100)*(b14+b15+b16+b17+b18).fdiv(5)).round(2)},
	            #{(year2.fdiv(100)*(c14+c15+c16+c17+c18).fdiv(5)).round(2)}],
	            color: colors[1]
	        }
	    }, {
	        y: #{year3},
	        color: colors[2],
	        drilldown: {
	            name: 'Chrome versions',
	            categories: ['Leaders', 'Representative Organizations', 'Others Organizations'],
	            data: [
	            #{(year3.fdiv(100)*(a19+a20+a21+a22+a23+a24+a25+a26).fdiv(8)).round(2)},
	            #{(year3.fdiv(100)*(b19+b20+b21+b22+b23+b24+b25+b26).fdiv(8)).round(2)},
	            #{(year3.fdiv(100)*(c19+c20+c21+c22+c23+c24+c25+c26).fdiv(8)).round(2)},
	 			],
	            color: colors[2]
	        }
	  
	    }],
	    browserData = [],
	    versionsData = [],
	    i,
	    j,
	    dataLen = data.length,
	    drillDataLen,
	    brightness;


	// Build the data arrays
	for (i = 0; i < dataLen; i += 1) {

	    // add browser data
	    browserData.push({
	        name: categories[i],
	        y: data[i].y,
	        color: data[i].color
	    });

	    // add version data
	    drillDataLen = data[i].drilldown.data.length;
	    for (j = 0; j < drillDataLen; j += 1) {
	        brightness = 0.2 - (j / drillDataLen) / 5;
	        versionsData.push({
	            name: data[i].drilldown.categories[j],
	            y: data[i].drilldown.data[j],
	            color: Highcharts.Color(data[i].color).brighten(brightness).get()
	        });
	    }
	}

	// Create the chart
	$('#piechart').highcharts({
	    chart: {
	        type: 'pie'
	    },
			title: {
	        	text: 'Retweets per Protest',
	        	x: -20 //center
		        },
	        subtitle: {
	            text: 'by actors nature',
	            x: -20
	        },
	        credits:{
	          text: '',
	          href: '',
	          display:'none'
	        },
	    yAxis: {
	        title: {
	            text: 'Total percent market share'
	        }
	    },
	    plotOptions: {
	        pie: {
	            shadow: false,
	            center: ['50%', '50%']
	        }
	    },
	    tooltip: {
	        valueSuffix: '%'
	    },
	    series: [{
	        name: 'Year',
	        data: browserData,
	        size: '60%',
	        dataLabels: {
	            formatter: function () {
	                return this.y > 5 ? this.point.name : null;
	            },
	            color: 'white',
	            distance: -30
	        }
	    }, {
	        name: 'Nature',
	        data: versionsData,
	        size: '80%',
	        innerSize: '60%',
	        dataLabels: {
	            formatter: function () {
	                // display only if larger than 1
	                return this.y > 1 ? '<b>' + this.point.name + ':</b> ' + this.y + '%' : null;
	            }
	        }
	    }]
	});
	});